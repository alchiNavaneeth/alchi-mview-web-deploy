import{a as N}from"./chunk-NUMDRLDL.js";import"./chunk-7D63BCU7.js";import"./chunk-GCLFISJJ.js";import"./chunk-UC3LMKJM.js";import{La as D,m as _}from"./chunk-3YWFRLHX.js";import{Bb as y,Dc as v,Fc as S,Mb as h,Wb as r,Xb as s,Yb as m,da as f,fc as x,fd as k,gb as l,hb as b,jd as I,kd as E,qc as d,sc as p,vb as w,wb as C}from"./chunk-ULTRSJM6.js";import"./chunk-EQDQRRRY.js";function R(o,e){if(o&1&&(r(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),m(4,"img",7),s(),r(5,"div",8),d(6),v(7,"date"),s(),r(8,"div",9),m(9,"video",10),s()(),r(10,"div",11)(11,"div",12),d(12),s()()()()),o&2){let n=x();l(6),p(" This livestream will expire as soon as it is ended by the user or by \u201C",S(7,2,n.LocalExpiryDate,"dd/MM/yyyy h:mm:ss a"),"\u201D "),l(6),p("\xA9 ",n.year," m-View Live Video Pty Ltd")}}function A(o,e){if(o&1&&(r(0,"div",13)(1,"div",4)(2,"div",5)(3,"div",6),m(4,"img",7),s(),r(5,"div",14),d(6,"Access Denied"),s(),r(7,"div",8),d(8,"You are not authorised to access this livestream or the link has expired."),s()(),r(9,"div",11)(10,"div",12),d(11),s()()()()),o&2){let n=x();l(11),p("\xA9 ",n.year," m-View Live Video Pty Ltd")}}function z(o,e){if(o&1&&(r(0,"div",15)(1,"div",4)(2,"div",5)(3,"div",6),m(4,"img",7),s(),r(5,"div",14),d(6,"Streamed Error"),s(),r(7,"div",8),d(8),s()(),r(9,"div",11)(10,"div",12),d(11),s()()()()),o&2){let n=x();l(8),p("Live stream is not Available for ",n.streamName,""),l(3),p("\xA9 ",n.year," m-View Live Video Pty Ltd")}}var P=class o{currentScreen="WebrtcfeedsScreen";year;player;version="";streamName="";applicationName="";wssUrl="";TokenExpiryTime="";LocalExpiryDate=new Date;wsConnection=null;videoElement=null;peerConnection=null;repeaterRetryCount=0;constructor(e){this.year=new Date().getFullYear(),this.currentScreen=e.getAttribute("screen"),this.streamName=window.streamName,this.applicationName=window.applicationName,this.wssUrl=window.wssUrl,this.TokenExpiryTime=window.TokenExpiryTime,this.LocalExpiryDate=new Date(this.TokenExpiryTime+" UTC"),console.log(this.LocalExpiryDate),console.log("constructor"),console.log("currentScreen "+this.currentScreen),console.log("streamName "+this.streamName),console.log("applicationName "+this.applicationName),console.log("wssUrl "+this.wssUrl)}wsConnect(){let e={applicationName:this.applicationName,streamName:this.streamName},n={iceServers:[]};this.peerConnection=new RTCPeerConnection(n);try{this.wsConnection=new WebSocket(this.wssUrl)}catch(t){console.log(t)}this.wsConnection&&(this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=()=>{console.log("onopen"),this.peerConnection.onicecandidate=this.gotIceCandidate,this.peerConnection.ontrack=t=>{console.log("gotRemoteTrack: kind:"+t.track.kind+" stream:"+t.streams[0]);try{this.videoElement.srcObject=t.streams[0]}catch(c){console.error("Error assigning stream to video element",c)}},this.sendPlayGetOffer(e,n)},this.wsConnection.onmessage=t=>{console.log("wsConnection.onmessage: "+t.data),this.handleWsMessage(t,e,n)},this.wsConnection.onclose=()=>{console.log("wsConnection.onclose")},this.wsConnection.onerror=t=>{console.log(t)})}sendPlayGetOffer(e,n){console.log("sendPlayGetOffer: "+JSON.stringify(e)),this.wsConnection.send(JSON.stringify({direction:"play",command:"getOffer",streamInfo:e,userData:n}))}gotIceCandidate=e=>{e.candidate&&this.wsConnection.send(JSON.stringify({ice:e.candidate}))};handleWsMessage(e,n,t){let c=JSON.parse(e.data),a=Number(c.status),i=c.command;a===514?(this.repeaterRetryCount++,this.repeaterRetryCount<10?setTimeout(()=>this.sendPlayGetOffer(n,t),500):(console.log("Live stream repeater timeout: "+this.streamName),this.stop())):a!==200?(console.log(c.statusDescription),this.stop(),this.currentScreen="WebrtcfeedsErrorScreen"):this.handleSdpAndIce(c,n,t),i==="sendResponse"&&this.wsConnection&&(this.wsConnection.close(),this.wsConnection=null)}handleSdpAndIce(e,n,t){e.streamInfo&&(n.sessionId=e.streamInfo.sessionId);let c=e.sdp;c&&(console.log("sdp: "+JSON.stringify(c)),this.mungeSDP&&(e.sdp.sdp=this.mungeSDP(e.sdp.sdp)),console.log("SDP Data: "+e.sdp.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e.sdp)).then(()=>this.peerConnection.createAnswer().then(i=>{this.peerConnection.setLocalDescription(i).then(()=>{console.log("sendAnswer"),this.wsConnection.send(JSON.stringify({direction:"play",command:"sendResponse",streamInfo:n,sdp:i,userData:t}))}).catch(g=>console.log("set local description error",g))})).catch(i=>console.log("set remote description error",i)));let a=e.iceCandidates;if(a)for(let i of a)console.log("iceCandidates: "+JSON.stringify(i)),this.peerConnection.addIceCandidate(new RTCIceCandidate(i))}mungeSDP(e){let n=e.split(/\r\n/),t="";for(let c of n)if(c.length!==0){if(c.includes("profile-level-id")){let a=c.indexOf("profile-level-id")+17,i=c.substring(a,a+6),g=parseInt(i.substring(0,2),16),O=parseInt(i.substring(2,4),16),u=parseInt(i.substring(4,6),16);g>66&&(g=66,O=224,u=31);let W=("00"+g.toString(16)).slice(-2).toLowerCase()+("00"+O.toString(16)).slice(-2).toLowerCase()+("00"+u.toString(16)).slice(-2).toLowerCase();c=c.replace(i,W)}t+=c+`\r
`}return t}stop(){this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.close(),this.peerConnection=null,this.wsConnection=null,this.videoElement&&(this.videoElement.srcObject=null)}ngAfterViewInit(){console.log("ngAfterViewInit"),this.currentScreen==="WebrtcfeedsScreen"&&(this.applicationName===""||this.streamName===""||this.wssUrl===""?alert("Please fill out the connection details"):(this.videoElement=document.getElementById("player-video"),this.wsConnect()))}ngOnInit(){}ngOnDestroy(){this.stop()}static \u0275fac=function(n){return new(n||o)(b(N))};static \u0275cmp=w({type:o,selectors:[["app-webrtc-feeds"]],standalone:!1,decls:3,vars:3,consts:[["id","webrtcfeeds-component","class","h-100 bg-image",4,"ngIf"],["id","accessdenied-component","class","h-100 bg-image",4,"ngIf"],["id","webrtcfeedserror-component","class","h-100 bg-image",4,"ngIf"],["id","webrtcfeeds-component",1,"h-100","bg-image"],[1,"g-0","overlay"],[1,"screen-card"],[1,"logo"],["src","assets/img/c8b00319-2bb7-4001-9316-580b17ffc717_480.png"],[1,"input-heading"],[1,"mfr-content"],["height","500","width","500","id","player-video","oncanplay","this.play()","onloadedmetadata","this.muted = true","autoplay","","playsinline","","muted","","controls",""],[1,"term-of-services"],[1,"version-text"],["id","accessdenied-component",1,"h-100","bg-image"],[1,"mfr-title"],["id","webrtcfeedserror-component",1,"h-100","bg-image"]],template:function(n,t){n&1&&y(0,R,13,5,"div",0)(1,A,12,1,"div",1)(2,z,12,2,"div",2),n&2&&(h("ngIf",t.currentScreen==="WebrtcfeedsScreen"),l(),h("ngIf",t.currentScreen==="AccessDeniedScreen"),l(),h("ngIf",t.currentScreen==="WebrtcfeedsErrorScreen"))},dependencies:[k,I],styles:['[_nghost-%COMP%]{width:100%;height:100%}#player-video[_ngcontent-%COMP%]{width:100%}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;display:flex;flex-direction:column;border-radius:8px;background:#ffffffed;box-shadow:0 4px 4px #00000040;padding:52px 10px 10px;max-width:820px;width:820px}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:176px;height:40px}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-title[_ngcontent-%COMP%]{color:#000;font-size:20px;font-style:normal;font-weight:700;line-height:normal;padding-top:36px;text-align:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-content[_ngcontent-%COMP%]{line-height:normal;padding-top:15px;text-align:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .input-heading[_ngcontent-%COMP%]{padding-top:18px;color:red;font-size:16px;font-style:normal;font-weight:400;line-height:normal;text-align:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-top:20px;margin-bottom:0}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #9d9fa2;background:#fff;width:20px;height:20px}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{color:#000;font-size:14px;font-style:normal;font-weight:400;line-height:normal}#webrtcfeeds-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]{bottom:0%;left:50%;transform:translate(-50%,-50%);position:absolute;color:var(--basic-white, #fff);text-align:center;font-size:14px;font-style:normal;font-weight:400}#webrtcfeeds-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration-line:underline;cursor:pointer}#webrtcfeeds-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   .version-text[_ngcontent-%COMP%]{padding-top:24px}.bg-image[_ngcontent-%COMP%]{background-image:url("/alchi-mview-web-deploy/media/default-login-PFOCJFUK.jpg");background-size:cover;background-position:center center;background-repeat:no-repeat}.bg-image[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#27343bb3}  .mat-form-field.mat-focused .mat-form-field-outline-thick{color:#2cace2!important}  .mat-form-field.mat-focused .mat-form-field-label{color:#2cace2!important}  .mat-mdc-form-field.mat-focused .mdc-notched-outline{border-color:#2cace2!important}  .mat-mdc-form-field.mat-focused .mdc-floating-label{color:#2cace2!important}  .mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:#2cace2!important}  .mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch{border-color:#2cace2!important}  .mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading{border-color:#2cace2!important}  .mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{font-size:14px!important;color:#000!important}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;display:flex;flex-direction:column;border-radius:8px;background:#ffffffed;box-shadow:0 4px 4px #00000040;padding:52px 60px 27px;max-width:420px;width:420px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:176px;height:40px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-title[_ngcontent-%COMP%]{color:red;font-size:20px;font-style:normal;font-weight:700;line-height:normal;padding-top:36px;text-align:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .input-heading[_ngcontent-%COMP%]{padding-top:18px;color:#000;font-size:16px;font-style:normal;font-weight:400;line-height:normal;text-align:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-top:20px;margin-bottom:0}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #9d9fa2;background:#fff;width:20px;height:20px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{color:#000;font-size:14px;font-style:normal;font-weight:400;line-height:normal}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]{padding-top:26px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:45px;background:#142430;width:100%;border:none;height:40px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]{padding-top:26px;display:flex;justify-content:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0f72ad;font-size:14px;font-style:normal;font-weight:400;line-height:normal;cursor:pointer}#accessdenied-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]{bottom:0%;left:50%;transform:translate(-50%,-50%);position:absolute;color:var(--basic-white, #fff);text-align:center;font-size:14px;font-style:normal;font-weight:400}#accessdenied-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration-line:underline;cursor:pointer}#accessdenied-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   .version-text[_ngcontent-%COMP%]{padding-top:24px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;display:flex;flex-direction:column;border-radius:8px;background:#ffffffed;box-shadow:0 4px 4px #00000040;padding:52px 60px 27px;max-width:420px;width:420px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:176px;height:40px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-title[_ngcontent-%COMP%]{color:red;font-size:20px;font-style:normal;font-weight:700;line-height:normal;padding-top:36px;text-align:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .input-heading[_ngcontent-%COMP%]{padding-top:18px;color:#000;font-size:16px;font-style:normal;font-weight:400;line-height:normal;text-align:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-top:20px;margin-bottom:0}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #9d9fa2;background:#fff;width:20px;height:20px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{color:#000;font-size:14px;font-style:normal;font-weight:400;line-height:normal}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]{padding-top:26px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:45px;background:#142430;width:100%;border:none;height:40px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]{padding-top:26px;display:flex;justify-content:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0f72ad;font-size:14px;font-style:normal;font-weight:400;line-height:normal;cursor:pointer}#webrtcfeedserror-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]{bottom:0%;left:50%;transform:translate(-50%,-50%);position:absolute;color:var(--basic-white, #fff);text-align:center;font-size:14px;font-style:normal;font-weight:400}#webrtcfeedserror-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration-line:underline;cursor:pointer}#webrtcfeedserror-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   .version-text[_ngcontent-%COMP%]{padding-top:24px}']})};var F=[{path:"",component:P}],M=class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=C({type:o});static \u0275inj=f({imports:[_.forChild(F),_]})};var L=class o{static \u0275fac=function(n){return new(n||o)};static \u0275mod=C({type:o});static \u0275inj=f({imports:[E,D.forRoot(),M]})};export{L as WebrtcFeedsModule};
