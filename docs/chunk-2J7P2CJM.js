import{a as D}from"./chunk-CZOWWZAT.js";import"./chunk-R7VYI33H.js";import"./chunk-SU2D24LB.js";import"./chunk-B462WD2V.js";import{La as E,m as M}from"./chunk-5TSWEN53.js";import{Bb as w,Dc as y,Fc as v,Mb as h,Wb as r,Xb as s,Yb as m,da as f,fc as x,fd as S,gb as l,hb as u,jd as k,kd as I,qc as d,sc as p,vb as b,wb as C}from"./chunk-EHZKD7YP.js";import"./chunk-SE5JAREP.js";function z(n,_){if(n&1&&(r(0,"div",3)(1,"div",4)(2,"div",5)(3,"div",6),m(4,"img",7),s(),r(5,"div",8),d(6),y(7,"date"),s(),r(8,"div",9),m(9,"video",10),s()(),r(10,"div",11)(11,"div",12),d(12),s()()()()),n&2){let e=x();l(6),p(" This livestream will expire as soon as it is ended by the user or by \u201C",v(7,2,e.LocalExpiryDate,"dd/MM/yyyy h:mm:ss a"),"\u201D "),l(6),p("\xA9 ",e.year," m-View Live Video Pty Ltd")}}function A(n,_){if(n&1&&(r(0,"div",13)(1,"div",4)(2,"div",5)(3,"div",6),m(4,"img",7),s(),r(5,"div",14),d(6,"Access Denied"),s(),r(7,"div",8),d(8,"You are not authorised to access this livestream or the link has expired."),s()(),r(9,"div",11)(10,"div",12),d(11),s()()()()),n&2){let e=x();l(11),p("\xA9 ",e.year," m-View Live Video Pty Ltd")}}function F(n,_){if(n&1&&(r(0,"div",15)(1,"div",4)(2,"div",5)(3,"div",6),m(4,"img",7),s(),r(5,"div",14),d(6,"Streamed Error"),s(),r(7,"div",8),d(8),s()(),r(9,"div",11)(10,"div",12),d(11),s()()()()),n&2){let e=x();l(8),p("Live stream is not Available for ",e.streamName,""),l(3),p("\xA9 ",e.year," m-View Live Video Pty Ltd")}}var L=(()=>{class n{currentScreen="WebrtcfeedsScreen";year;player;version="";streamName="";applicationName="";wssUrl="";TokenExpiryTime="";LocalExpiryDate=new Date;wsConnection=null;videoElement=null;peerConnection=null;repeaterRetryCount=0;constructor(e){this.year=new Date().getFullYear(),this.currentScreen=e.getAttribute("screen"),this.streamName=window.streamName,this.applicationName=window.applicationName,this.wssUrl=window.wssUrl,this.TokenExpiryTime=window.TokenExpiryTime,this.LocalExpiryDate=new Date(this.TokenExpiryTime+" UTC"),console.log(this.LocalExpiryDate),console.log("constructor"),console.log("currentScreen "+this.currentScreen),console.log("streamName "+this.streamName),console.log("applicationName "+this.applicationName),console.log("wssUrl "+this.wssUrl)}wsConnect(){let e={applicationName:this.applicationName,streamName:this.streamName},t={iceServers:[]};this.peerConnection=new RTCPeerConnection(t);try{this.wsConnection=new WebSocket(this.wssUrl)}catch(o){console.log(o)}this.wsConnection&&(this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=()=>{console.log("onopen"),this.peerConnection.onicecandidate=this.gotIceCandidate,this.peerConnection.ontrack=o=>{console.log("gotRemoteTrack: kind:"+o.track.kind+" stream:"+o.streams[0]);try{this.videoElement.srcObject=o.streams[0]}catch(c){console.error("Error assigning stream to video element",c)}},this.sendPlayGetOffer(e,t)},this.wsConnection.onmessage=o=>{console.log("wsConnection.onmessage: "+o.data),this.handleWsMessage(o,e,t)},this.wsConnection.onclose=()=>{console.log("wsConnection.onclose")},this.wsConnection.onerror=o=>{console.log(o)})}sendPlayGetOffer(e,t){console.log("sendPlayGetOffer: "+JSON.stringify(e)),this.wsConnection.send(JSON.stringify({direction:"play",command:"getOffer",streamInfo:e,userData:t}))}gotIceCandidate=e=>{e.candidate&&this.wsConnection.send(JSON.stringify({ice:e.candidate}))};handleWsMessage(e,t,o){let c=JSON.parse(e.data),a=Number(c.status),i=c.command;a===514?(this.repeaterRetryCount++,this.repeaterRetryCount<10?setTimeout(()=>this.sendPlayGetOffer(t,o),500):(console.log("Live stream repeater timeout: "+this.streamName),this.stop())):a!==200?(console.log(c.statusDescription),this.stop(),this.currentScreen="WebrtcfeedsErrorScreen"):this.handleSdpAndIce(c,t,o),i==="sendResponse"&&this.wsConnection&&(this.wsConnection.close(),this.wsConnection=null)}handleSdpAndIce(e,t,o){e.streamInfo&&(t.sessionId=e.streamInfo.sessionId);let c=e.sdp;c&&(console.log("sdp: "+JSON.stringify(c)),this.mungeSDP&&(e.sdp.sdp=this.mungeSDP(e.sdp.sdp)),console.log("SDP Data: "+e.sdp.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(e.sdp)).then(()=>this.peerConnection.createAnswer().then(i=>{this.peerConnection.setLocalDescription(i).then(()=>{console.log("sendAnswer"),this.wsConnection.send(JSON.stringify({direction:"play",command:"sendResponse",streamInfo:t,sdp:i,userData:o}))}).catch(g=>console.log("set local description error",g))})).catch(i=>console.log("set remote description error",i)));let a=e.iceCandidates;if(a)for(let i of a)console.log("iceCandidates: "+JSON.stringify(i)),this.peerConnection.addIceCandidate(new RTCIceCandidate(i))}mungeSDP(e){let t=e.split(/\r\n/),o="";for(let c of t)if(c.length!==0){if(c.includes("profile-level-id")){let a=c.indexOf("profile-level-id")+17,i=c.substring(a,a+6),g=parseInt(i.substring(0,2),16),P=parseInt(i.substring(2,4),16),O=parseInt(i.substring(4,6),16);g>66&&(g=66,P=224,O=31);let W=("00"+g.toString(16)).slice(-2).toLowerCase()+("00"+P.toString(16)).slice(-2).toLowerCase()+("00"+O.toString(16)).slice(-2).toLowerCase();c=c.replace(i,W)}o+=c+`\r
`}return o}stop(){this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.close(),this.peerConnection=null,this.wsConnection=null,this.videoElement&&(this.videoElement.srcObject=null)}ngAfterViewInit(){console.log("ngAfterViewInit"),this.currentScreen==="WebrtcfeedsScreen"&&(this.applicationName===""||this.streamName===""||this.wssUrl===""?alert("Please fill out the connection details"):(this.videoElement=document.getElementById("player-video"),this.wsConnect()))}ngOnInit(){}ngOnDestroy(){this.stop()}static \u0275fac=function(t){return new(t||n)(u(D))};static \u0275cmp=b({type:n,selectors:[["app-webrtc-feeds"]],standalone:!1,decls:3,vars:3,consts:[["id","webrtcfeeds-component","class","h-100 bg-image",4,"ngIf"],["id","accessdenied-component","class","h-100 bg-image",4,"ngIf"],["id","webrtcfeedserror-component","class","h-100 bg-image",4,"ngIf"],["id","webrtcfeeds-component",1,"h-100","bg-image"],[1,"g-0","overlay"],[1,"screen-card"],[1,"logo"],["src","assets/img/c8b00319-2bb7-4001-9316-580b17ffc717_480.png"],[1,"input-heading"],[1,"mfr-content"],["height","500","width","500","id","player-video","oncanplay","this.play()","onloadedmetadata","this.muted = true","autoplay","","playsinline","","muted","","controls",""],[1,"term-of-services"],[1,"version-text"],["id","accessdenied-component",1,"h-100","bg-image"],[1,"mfr-title"],["id","webrtcfeedserror-component",1,"h-100","bg-image"]],template:function(t,o){t&1&&w(0,z,13,5,"div",0)(1,A,12,1,"div",1)(2,F,12,2,"div",2),t&2&&(h("ngIf",o.currentScreen==="WebrtcfeedsScreen"),l(),h("ngIf",o.currentScreen==="AccessDeniedScreen"),l(),h("ngIf",o.currentScreen==="WebrtcfeedsErrorScreen"))},dependencies:[S,k],styles:[`[_nghost-%COMP%]{width:100%;height:100%}#player-video[_ngcontent-%COMP%]{width:100%}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;display:flex;flex-direction:column;border-radius:8px;background:#ffffffed;box-shadow:0 4px 4px #00000040;padding:52px 10px 10px;max-width:820px;width:820px}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:176px;height:40px}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-title[_ngcontent-%COMP%]{color:#000;font-size:20px;font-style:normal;font-weight:700;line-height:normal;padding-top:36px;text-align:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-content[_ngcontent-%COMP%]{line-height:normal;padding-top:15px;text-align:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .input-heading[_ngcontent-%COMP%]{padding-top:18px;color:red;font-size:16px;font-style:normal;font-weight:400;line-height:normal;text-align:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-top:20px;margin-bottom:0}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #9d9fa2;background:#fff;width:20px;height:20px}#webrtcfeeds-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{color:#000;font-size:14px;font-style:normal;font-weight:400;line-height:normal}#webrtcfeeds-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]{bottom:0%;left:50%;transform:translate(-50%,-50%);position:absolute;color:var(--basic-white, #fff);text-align:center;font-size:14px;font-style:normal;font-weight:400}#webrtcfeeds-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration-line:underline;cursor:pointer}#webrtcfeeds-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   .version-text[_ngcontent-%COMP%]{padding-top:24px}.bg-image[_ngcontent-%COMP%]{background-image:url("/Angular/WebForms/media/default-login.jpg");background-size:cover;background-position:center center;background-repeat:no-repeat}.bg-image[_ngcontent-%COMP%]   .overlay[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#27343bb3}  .mat-form-field.mat-focused .mat-form-field-outline-thick{color:#2cace2!important}  .mat-form-field.mat-focused .mat-form-field-label{color:#2cace2!important}  .mat-mdc-form-field.mat-focused .mdc-notched-outline{border-color:#2cace2!important}  .mat-mdc-form-field.mat-focused .mdc-floating-label{color:#2cace2!important}  .mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__trailing{border-color:#2cace2!important}  .mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__notch{border-color:#2cace2!important}  .mdc-text-field--outlined:not(.mdc-text-field--disabled).mdc-text-field--focused .mdc-notched-outline__leading{border-color:#2cace2!important}  .mat-mdc-form-field-input-control.mat-mdc-form-field-input-control{font-size:14px!important;color:#000!important}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;display:flex;flex-direction:column;border-radius:8px;background:#ffffffed;box-shadow:0 4px 4px #00000040;padding:52px 60px 27px;max-width:420px;width:420px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:176px;height:40px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-title[_ngcontent-%COMP%]{color:red;font-size:20px;font-style:normal;font-weight:700;line-height:normal;padding-top:36px;text-align:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .input-heading[_ngcontent-%COMP%]{padding-top:18px;color:#000;font-size:16px;font-style:normal;font-weight:400;line-height:normal;text-align:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-top:20px;margin-bottom:0}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #9d9fa2;background:#fff;width:20px;height:20px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{color:#000;font-size:14px;font-style:normal;font-weight:400;line-height:normal}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]{padding-top:26px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:45px;background:#142430;width:100%;border:none;height:40px}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]{padding-top:26px;display:flex;justify-content:center}#accessdenied-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0f72ad;font-size:14px;font-style:normal;font-weight:400;line-height:normal;cursor:pointer}#accessdenied-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]{bottom:0%;left:50%;transform:translate(-50%,-50%);position:absolute;color:var(--basic-white, #fff);text-align:center;font-size:14px;font-style:normal;font-weight:400}#accessdenied-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration-line:underline;cursor:pointer}#accessdenied-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   .version-text[_ngcontent-%COMP%]{padding-top:24px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]{top:50%;left:50%;transform:translate(-50%,-50%);position:absolute;display:flex;flex-direction:column;border-radius:8px;background:#ffffffed;box-shadow:0 4px 4px #00000040;padding:52px 60px 27px;max-width:420px;width:420px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{display:flex;justify-content:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:176px;height:40px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .mfr-title[_ngcontent-%COMP%]{color:red;font-size:20px;font-style:normal;font-weight:700;line-height:normal;padding-top:36px;text-align:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .input-heading[_ngcontent-%COMP%]{padding-top:18px;color:#000;font-size:16px;font-style:normal;font-weight:400;line-height:normal;text-align:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{padding-top:20px;margin-bottom:0}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border-radius:5px;border:1px solid #9d9fa2;background:#fff;width:20px;height:20px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .checkbox-div[_ngcontent-%COMP%]   .checkbox-text[_ngcontent-%COMP%]{color:#000;font-size:14px;font-style:normal;font-weight:400;line-height:normal}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]{padding-top:26px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .login-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:45px;background:#142430;width:100%;border:none;height:40px}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]{padding-top:26px;display:flex;justify-content:center}#webrtcfeedserror-component[_ngcontent-%COMP%]   .screen-card[_ngcontent-%COMP%]   .anchor-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#0f72ad;font-size:14px;font-style:normal;font-weight:400;line-height:normal;cursor:pointer}#webrtcfeedserror-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]{bottom:0%;left:50%;transform:translate(-50%,-50%);position:absolute;color:var(--basic-white, #fff);text-align:center;font-size:14px;font-style:normal;font-weight:400}#webrtcfeedserror-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration-line:underline;cursor:pointer}#webrtcfeedserror-component[_ngcontent-%COMP%]   .term-of-services[_ngcontent-%COMP%]   .version-text[_ngcontent-%COMP%]{padding-top:24px}
/*# sourceMappingURL=/Angular/WebForms/webrtc-feeds.component.css.map */`]})}return n})();var R=[{path:"",component:L}],T=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=C({type:n});static \u0275inj=f({imports:[M.forChild(R),M]})}return n})();var X=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=C({type:n});static \u0275inj=f({imports:[I,E.forRoot(),T]})}return n})();export{X as WebrtcFeedsModule};
//# sourceMappingURL=chunk-2J7P2CJM.js.map
